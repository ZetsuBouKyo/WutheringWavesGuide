var As=Object.defineProperty;var Is=(o,s,t)=>s in o?As(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var a=(o,s,t)=>Is(o,typeof s!="symbol"?s+"":s,t);import{A as Ns,d as b,R as I,S as l,e as d,f as $,B as n,u as vs,h as y,i as p,j as ys,m as Bs,k as w,l as xs,n as Z,E as u,o as c,p as m}from"./resonator-C8vTBfod.js";import{d as h,g as ws,m as Os,t as P}from"./utils-CKOygh4Q.js";import{ai as W,a_ as U}from"./index-C7j9b9qh.js";import{A}from"./affix-NmzP8Gk5.js";const Ts=[{name:"角",cost:"4",sonatas:["浮星祛暗"]},{name:"赫卡忒",cost:"4",sonatas:["高天共奏之曲"]},{name:"鳴鐘之龜",cost:"4",sonatas:["隱世回光","輕雲出月"]},{name:"無妄者",cost:"4",sonatas:["沉日劫明"]},{name:"無歸的謬誤",cost:"4",sonatas:["隱世回光"]},{name:"異構武裝",cost:"4",sonatas:["凌冽決斷之心"]},{name:"羅蕾萊",cost:"4",sonatas:["幽夜隱匿之帷"]},{name:"燎照之騎",cost:"4",sonatas:["熔山裂谷"]},{name:"夢魘·燎照之騎",cost:"4",sonatas:["熔山裂谷"]},{name:"雲閃之鱗",cost:"4",sonatas:["徹空冥雷"]},{name:"夢魘·雲閃之鱗",cost:"4",sonatas:["徹空冥雷"]},{name:"夢魘·朔雷之鱗",cost:"4",sonatas:["徹空冥雷","高天共奏之曲"]},{name:"朔雷之鱗",cost:"4",sonatas:["徹空冥雷"]},{name:"聚械機偶",cost:"4",sonatas:["不絕餘音"]},{name:"輝螢軍勢",cost:"4",sonatas:["凝夜白霜"]},{name:"嘆息古龍",cost:"4",sonatas:["無懼浪濤之勇"]},{name:"夢魘·無冠者",cost:"4",sonatas:["沉日劫明"]},{name:"無冠者",cost:"4",sonatas:["沉日劫明"]},{name:"夢魘·哀聲鷙",cost:"4",sonatas:["此間永駐之光"]},{name:"哀聲鷙",cost:"4",sonatas:["浮星祛暗"]},{name:"夢魘·無常凶鷺",cost:"4",sonatas:["幽夜隱匿之帷"]},{name:"無常凶鷺",cost:"4",sonatas:["輕雲出月"]},{name:"夢魘·飛廉之猩",cost:"4",sonatas:["嘯谷長風"]},{name:"飛廉之猩",cost:"4",sonatas:["嘯谷長風"]},{name:"遊鱗機樞",cost:"3"},{name:"巡哨機傀",cost:"3"},{name:"磐石守衛",cost:"3"},{name:"冥淵守衛",cost:"3"},{name:"奏諭樂師",cost:"3"},{name:"振鐸樂師",cost:"3"},{name:"堅岩鬥士",cost:"3"},{name:"刺玫菇",cost:"3"},{name:"車刃鐮",cost:"3"},{name:"踏光獸",cost:"3"},{name:"雪鬃狼",cost:"3"},{name:"戲猿",cost:"3"},{name:"暗鬃狼",cost:"3"},{name:"箭簇熊",cost:"3"},{name:"綠熔蜥",cost:"3"},{name:"紫羽鷺",cost:"3"},{name:"青羽鷺",cost:"3"},{name:"通行燈偶",cost:"1"},{name:"審判戰士",cost:"1"},{name:"鳴泣戰士",cost:"1"},{name:"巡徊獵手",cost:"1"},{name:"破霜獵手",cost:"1"},{name:"驚蟄獵手",cost:"1"},{name:"裂變幼岩",cost:"1"},{name:"先鋒幼岩",cost:"1"},{name:"刺玫菇 (稚形)",cost:"1"},{name:"衍射棱鏡",cost:"1"},{name:"湮滅棱鏡",cost:"1"},{name:"熱熔棱鏡",cost:"1"},{name:"冷凝棱鏡",cost:"1"},{name:"侏侏鴕",cost:"1"},{name:"融火蟲",cost:"1"},{name:"幼猿",cost:"1"},{name:"寒霜陸龜",cost:"1"},{name:"游弋蝶",cost:"1"},{name:"晶螯蠍",cost:"1"},{name:"火鬃狼",cost:"1"},{name:"碎獠豬",cost:"1"},{name:"綠熔蜥 (稚形)",cost:"1"},{name:"遁地鼠",cost:"1"},{name:"啾啾河豚",cost:"1"},{name:"咕咕河豚",cost:"1"},{name:"叮咚咚",cost:"1"},{name:"嗚咔咔",cost:"1"},{name:"阿嗞嗞",cost:"1"},{name:"咔嚓嚓",cost:"1"},{name:"呼咻咻",cost:"1"}],Ms={凝夜白霜:{2:"冷凝傷害提升10%",5:"使用普攻或重擊時，冷凝傷害提升10%，該效果可疊加三層，持續15秒。"},熔山裂谷:{2:"熱熔傷害提升10%",5:"使用共鳴技能時，熱熔傷害提升30%，持續15秒。"},徹空冥雷:{2:"導電傷害提升10%",5:"使用重擊或共鳴技能時，各獲得一層導電傷害提升15%的效果，該效果可疊加兩層，每層各持續15秒。"},嘯谷長風:{2:"氣動傷害提升10%",5:"使用變奏技能登場時，氣動傷害提升30%，持續15秒。"},浮星祛暗:{2:"衍射傷害提升10%",5:"使用變奏技能登場時，衍射傷害提升30%，持續15秒。"},沉日劫明:{2:"湮滅傷害提升10%",5:"使用普攻或重擊時，湮滅傷害提升7.5%，該效果可疊加四層，持續15秒。"},隱世回光:{2:"治療效果提升10%",5:"自身為友方提供治療時，全隊共鳴者攻擊提升15%，持續30秒。"},輕雲出月:{2:"共鳴效率提升10%",5:"使用延奏技能後，下一個登場的共鳴者攻擊提升22.5%，持續15秒。"},不絕餘音:{2:"攻擊提升10%",5:"在場時，自身攻擊每1.5秒提升5%，該效果最多疊加四層。延奏技能傷害提升60%。"},凌冽決斷之心:{2:"共鳴技能傷害提升12%",5:"施放共鳴技能時，自身冷凝傷害提升22.5%，持續15秒；施放共鳴解放時，自身共鳴技能傷害提升18%，持續5秒，可疊加2層。"},此間永駐之光:{2:"衍射傷害提升10%",5:"角色為敵人添加【光噪效應】時，自身暴擊提升20%，持續15秒；攻擊存在10層【光噪效應】的敵人時，自身衍射傷害加成提升15%，持續15秒。"},幽夜隱匿之帷:{2:"湮滅屬性傷害提升10%",5:"角色觸發延奏技能離場時，額外對周圍敵人造成480%的湮滅傷害，該傷害為延奏技能傷害，並使下一個登場角色湮滅屬性傷害加成提升15%，持續15秒。"},高天共奏之曲:{2:"共鳴效率提升10%",5:"當前角色協同攻擊造成的傷害提升80%；協同攻擊命中敵人且暴擊時，隊伍中登場角色攻擊力提升20%，持續4秒。"},無懼浪濤之勇:{2:"共鳴效率提升10%%",5:"角色攻擊提升15%，共鳴效率達到250%後，當前角色全屬性傷害提升30%。"}},Ls=[320,360,390,430,470,510,540,580],Cs=[.064,.071,.079,.086,.094,.101,.109,.116],Fs=[30,40,50],Ds=[.064,.071,.079,.086,.094,.101,.109,.116],Gs=[40,50,60],Ps=[.081,.09,.1,.109,.118,.128,.138,.147],Us=[.063,.069,.075,.081,.087,.093,.099,.105],Hs=[.126,.138,.15,.162,.174,.186,.198,.21],Ks=[.064,.071,.079,.086,.094,.101,.109,.116],Vs=[.064,.071,.079,.086,.094,.101,.109,.116],$s=[.064,.071,.079,.086,.094,.101,.109,.116],Ws=[.064,.071,.079,.086,.094,.101,.109,.116],js=[.068,.076,.084,.092,.1,.108,.116,.124],q={hp:Ls,hp_p:Cs,atk:Fs,atk_p:Ds,def:Gs,def_p:Ps,crit_rate:Us,crit_dmg:Hs,bonus_resonance_skill:Ks,bonus_basic_attack:Vs,bonus_heavy_attack:$s,bonus_resonance_liberation:Ws,energy_regen:js},K=Object.keys(Ms),H=[{name:"白板3C聲骸",cost:"3",sonatas:K},{name:"白板1C聲骸",cost:"1",sonatas:K},...Ts],M=W("echo",{state:()=>({}),actions:{getEchoItemForCalculationByName(o){for(const s of H)if(s.name===o)return{title:o,value:s};return{title:o,value:void 0}},getEchoNames(){return H.map((s,t,e)=>s.name)},getEchoItemsForCalculation(){return H.map((s,t,e)=>({title:s.name,value:s}))},getSubAffixKeys(){return Object.keys(q)},getSubAffixValues(o){const s=q[o.toLowerCase()];return s||[]},getCosts(){return["4","3","1"]},getSonataNames(){return K},getAbbrs(){return Object.values(Ns)}}});class B{constructor(){a(this,"id","");a(this,"level","");a(this,"type","");a(this,"base_attr","");a(this,"bonus_types",[]);a(this,"elment_zh_tw","");a(this,"dmg","")}duplicate(){const s=new B;return s.id=this.id,s.type=this.type,s.base_attr=this.base_attr,s.bonus_types=this.bonus_types,s.elment_zh_tw=this.elment_zh_tw,s.dmg=this.dmg,s}}class C{constructor(){a(this,"id","");a(this,"no","");a(this,"name","");a(this,"element_zh_tw","");a(this,"level","90");a(this,"chain","1");a(this,"hp","");a(this,"atk","");a(this,"def","");a(this,"energy_regen","");a(this,"normal_attack_lv","10");a(this,"resonance_skill_lv","10");a(this,"forte_circuit_lv","10");a(this,"resonance_liberation_lv","10");a(this,"intro_skill_lv","10");a(this,"inherent_skill_1",!0);a(this,"inherent_skill_2",!0);a(this,"stat_bonus",new b);a(this,"skill",new B);a(this,"_skill_item",{title:"",value:void 0});a(this,"_info")}duplicate(){const s=new C;return s.id=this.id,s.no=this.no,s.name=this.name,s.element_zh_tw=this.element_zh_tw,s.level=this.level,s.chain=this.chain,s.hp=this.hp,s.atk=this.atk,s.def=this.def,s.energy_regen=this.energy_regen,s.normal_attack_lv=this.normal_attack_lv,s.resonance_skill_lv=this.resonance_skill_lv,s.forte_circuit_lv=this.forte_circuit_lv,s.resonance_liberation_lv=this.resonance_liberation_lv,s.intro_skill_lv=this.intro_skill_lv,s.inherent_skill_1=this.inherent_skill_1,s.inherent_skill_2=this.inherent_skill_2,s.stat_bonus=this.stat_bonus.duplicate(),s.skill=this.skill.duplicate(),s._skill_item={title:this._skill_item.title,value:void 0},this._skill_item.value!==void 0&&(s._skill_item.value=this._skill_item.value.duplicate()),this._info!==void 0&&(s._info=this._info.duplicate()),s}getBaseAttrs(){const s=[],t=new I;t.stack="1";let e,i=this.skill.base_attr;switch(this.skill.base_attr){case l.HP:e=h(this.hp).toString();break;case l.DEF:e=h(this.def).toString();break;case l.ATK:default:e=h(this.atk).toString(),i=l.ATK;break}return this.name&&(i=`${this.name}-${i}`),t.category=d.ATTR,t.source=i,t.value=e,t.type=$.ATTR,t.updateId(),s.push(t),s}getRowBuffs(){return this.stat_bonus.getRowBuffs(this.name)}getSkillRowBuffs(){const s=[],t=new I;t.category=d.RESONATOR,t.type=n.SKILL_DMG_ADDITION,t.value=h(this.skill.dmg).toString(),t.stack="1";let e="";return this.name&&(e=this.name),this.skill.type&&(e=`${e}-${this.skill.type}`),this.skill.id&&(e=`${e}-${this.skill.id}`),t.source=e,t.updateId(),t.value&&s.push(t),s}async updateByName(){const s=vs();this.stat_bonus=new b,this.skill=new B,this._skill_item={title:"",value:void 0};const t=this.name,e=s.getNoByName(t);if(!e)return;this.no=e;const i=await s.getInfoByName(t);this._info=i,this.element_zh_tw=i.element_zh_tw;const _=this.level;this.hp=i.getHp(_),this.atk=i.getAtk(_),this.def=i.getDef(_);const r=i.stat_bonus;Object.keys(r).forEach(k=>{const g=r[k];this.stat_bonus[k]=g})}updateSkillDmg(s){if(s.dmg){this.skill.dmg=s.dmg;return}const t=this.skill.type;let e;switch(t){case y.NORMAL_ATTACK:e=this.normal_attack_lv;break;case y.RESONANCE_SKILL:e=this.resonance_skill_lv;break;case y.FORTE_CIRCUIT:e=this.forte_circuit_lv;break;case y.RESONANCE_LIBERATION:e=this.resonance_liberation_lv;break;case y.INTRO_SKILL:e=this.intro_skill_lv;break;default:e="10"}this.skill.level=e,this.skill.dmg=s[`lv${e}`]}updateSkill(s=void 0){if(!s){if(!this._skill_item)return;s=this._skill_item.value}s&&(this.skill=new B,this.skill.id=s.id,this.skill.type=s.skill_type,this.skill.base_attr=s.base_attr,s.element&&(this.skill.elment_zh_tw=s.element,this.skill.bonus_types.push(s.element)),s.bonus_type&&this.skill.bonus_types.push(s.bonus_type),s.coordinated&&this.skill.bonus_types.push(p.COORDINATED_ATTACK),this.updateSkillDmg(s))}updateSkillById(s){var e;let t=(e=this._info)==null?void 0:e.getDamageSkillItemById(s);t||(t=ys(s)),t&&this.updateSkill(t.value)}}const L={教學長刃:"21010011","原初長刃·朴石":"21010012","暗夜長刃·玄明":"21010013",浩境粼光:"21010015",蒼鱗千嶂:"21010016","源能長刃·測壹":"21010023",異響空靈:"21010024",時和歲稔:"21010026","重破刃-41型":"21010034","遠行者長刃·辟路":"21010043",永夜長明:"21010044","戍關長刃·定軍":"21010053",鈞天正音:"21010063",東落:"21010064",紋秋:"21010074",凋亡頻移:"21010084",容赦的沉思錄:"21010094",教學迅刀:"21020011","原初迅刀·鳴雨":"21020012","暗夜迅刀·黑閃":"21020013",千古洑流:"21020015",赫奕流明:"21020016",心之錨:"21020017","源能迅刀·測貳":"21020023",行進序曲:"21020024",裁春:"21020026","瞬斬刀-18型":"21020034",不滅航路:"21020036","遠行者迅刀·旅跡":"21020043",不歸孤軍:"21020044","戍關迅刀·鎮海":"21020053",西升:"21020064",飛景:"21020074",永續坍縮:"21020084",風流的寓言詩:"21020094",教學佩槍:"21030011","原初佩槍·穿林":"21030012","暗夜佩槍·暗星":"21030013",停駐之煙:"21030015",死與舞:"21030016","源能佩槍·測叄":"21030023",華彩樂段:"21030024","穿擊槍-26型":"21030034","遠行者佩槍·洞察":"21030043",無眠烈火:"21030044","戍關佩槍·平雲":"21030053",飛逝:"21030064",奔雷:"21030074",悖論噴流:"21030084",敘別的羅曼史:"21030094",教學臂鎧:"21040011","原初臂鎧·磐岩":"21040012","暗夜臂鎧·夜芒":"21040013",擎淵怒濤:"21040015",諸方玄樞:"21040016","源能臂鎧·測肆":"21040023",呼嘯重音:"21040024",悲喜劇:"21040026","鋼影拳-21丁型":"21040034","遠行者臂鎧·破障":"21040043",袍澤之固:"21040044","戍關臂鎧·拔山":"21040053",駭行:"21040064",金掌:"21040074",塵雲旋臂:"21040084",酩酊的英雄志:"21040094",教學音感儀:"21050011","原初音感儀·聽浪":"21050012","暗夜矩陣·暝光":"21050013",漪瀾浮錄:"21050015",掣傀之手:"21050016",淵海回聲:"21050017","源能音感儀·測五":"21050023",奇幻變奏:"21050024",瓊枝冰綃:"21050026",大海的饋贈:"21050027","鳴動儀-25型":"21050034",星序協響:"21050036","遠行者矩陣·探幽":"21050043",今州守望:"21050044",和光回唱:"21050046","戍關音感儀·留光":"21050053",異度:"21050064",清音:"21050074",核熔星盤:"21050084",虛飾的華爾茲:"21050094"},Js=Object.values(L),zs=[],Xs=W("weapon",{state:()=>({}),actions:{getNames(o=!1){const s=Object.keys(L);if(o===!0)return s;const t=[];return s.forEach(e=>{zs.includes(e)||t.push(e)}),t},getTunes(){return new Array("1","2","3","4","5")},getNoByName(o){return L[o]},getNameByNo(o){return ws(L,o)},async getInfoByNo(o){try{const s=Bs(`/data/weapons/${o}/info.json`);return Js.includes(o)?await s.get():void 0}catch(s){return s}},async getInfoByName(o){const s=this.getNoByName(o);return await this.getInfoByNo(s)}}});class j{constructor(s={}){a(this,"no","");a(this,"name","");a(this,"star","");a(this,"type","");a(this,"passive",{name:"",description:"",passive_buffs:[]});a(this,"attrs",[]);s&&Object.keys(s).length>0&&Object.assign(this,s)}duplicate(){const s=new j;return s.no=this.no,s.name=this.name,s.star=this.star,s.type=this.type,s.passive=JSON.parse(JSON.stringify(this.passive)),s.attrs=JSON.parse(JSON.stringify(this.attrs)),s}getMaxLevel(){const s=this.attrs;let t=h(0);for(const e of s){const i=h(e.lv);t=Math.max(t,i)}return t.toString()}getAtk(s){const t=this.attrs;for(const e of t)if(s===e.lv)return e.atk;return""}getStatBonus(s){const t=this.attrs;for(const e of t)if(s===e.lv){const i=Object.keys(e);for(const _ of i)if(_!=="lv"&&_!=="atk")return{[_]:e[_]}}return{}}getPassiveStatBonus(s){const t=this.passive.passive_buffs;if(t.length===0)return{};const e=parseInt(s)-1;return e<0||e>4?{}:t[e]}}class F{constructor(){a(this,"no","");a(this,"name","");a(this,"star","");a(this,"type","");a(this,"level","90");a(this,"tune","1");a(this,"atk","");a(this,"stat_bonus",new b);a(this,"passive_stat_bonus",new b);a(this,"_info")}duplicate(){const s=new F;return s.no=this.no,s.name=this.name,s.star=this.star,s.type=this.type,s.level=this.level,s.tune=this.tune,s.atk=this.atk,s.stat_bonus=this.stat_bonus.duplicate(),s.passive_stat_bonus=this.passive_stat_bonus.duplicate(),this._info!==void 0&&(s._info=this._info.duplicate()),s}getBaseAttrs(){const s=[],t=new I;let e=l.ATK;return this.name&&(e=`${this.name}-${e}`),t.source=e,t.category=d.ATTR,t.value=this.atk,t.stack="1",t.type=$.ATTR,t.updateId(),t.value&&s.push(t),s}getRowBuffs(){let s="";this.name&&(s=this.name),this.tune&&(s=`${s}-${this.tune}${w.TUNE}`);let t=`${s}-${w.PASSIVE}`;const e=this.passive_stat_bonus.getRowBuffs(t);return[...this.stat_bonus.getRowBuffs(s),...e]}getMaxLevel(){return this._info?this._info.getMaxLevel():"90"}getLevels(){const s=new Array("1","20","20+","40","40+","50","50+","60","60+","70","70+","80","80+","90"),t=[],e=h(this.getMaxLevel());s.forEach(_=>{h(_)<=e&&t.push(_)});const i=t.at(-1);return i&&i.includes("+")&&t.pop(),t}async updateRowWeaponByName(){const s=this.name;if(!s)return;const t=Xs();this.stat_bonus=new b,this.passive_stat_bonus=new b;const e=t.getNoByName(s);if(this.no=e,!this.no)return;const i=new j(await t.getInfoByNo(e));this._info=i,this.star=i.star,this.type=i.type;const _=i.getMaxLevel(),r=h(this.level),k=h(_);r>k?this.level=_:r===k&&this.level.includes("+")&&(this.level=_);const g=this.level;if(g){this.atk=i.getAtk(g);const S=i.getStatBonus(g);Object.keys(S).forEach(E=>{const N=S[E];this.stat_bonus[E]=h(N).toString()})}if(this.tune){const S=i.getPassiveStatBonus(this.tune);Object.keys(S).forEach(E=>{const N=S[E];this.passive_stat_bonus[E]=h(N).toString()})}}}const R={HECATE:"赫卡忒",SENTRY_CONSTRUCT:"異構武裝",LORELEI:"羅蕾萊",NIGHTMARE_INFERNO_RIDER:"夢魘·燎照之騎",NIGHTMARE_THUNDERING_MEPHIS:"夢魘·雲閃之鱗",NIGHTMARE_TEMPEST_MEPHIS:"夢魘·朔雷之鱗",DRAGON_OF_DIRGE:"嘆息古龍",NIGHTMARE_CROWNLESS:"夢魘·無冠者",NIGHTMARE_MOURNING_AIX:"夢魘·哀聲鷙",NIGHTMARE_IMPERMANENCE_HERON:"夢魘·無常凶鷺",NIGHTMARE_FEILIAN_BERINGAL:"夢魘·飛廉之猩"},f={FREEZING_FROST:"凝夜白霜",MOLTEN_RIFT:"熔山裂谷",VOID_THUNDER:"徹空冥雷",SIERRA_GALE:"嘯谷長風",CELESTIAL_LIGHT:"浮星祛暗",SUN_SINKING_ECLIPSE:"沉日劫明",REJUVENATING_GLOW:"隱世回光",MOONLIT_CLOUDS:"輕雲出月",LINGERING_TUNES:"不絕餘音",FROSTY_RESOLVE:"凌冽決斷之心",ETERNAL_RADIANCE:"此間永駐之光",MIDNIGHT_VEIL:"幽夜隱匿之帷",EMPYREAN_ANTHEM:"高天共奏之曲",TIDEBREAKING_COURAGE:"無懼浪濤之勇"},Ys={1:{hp:"2280"},3:{atk:"100"},4:{atk:"150"}},Zs={1:{hp_p:"0.228",atk_p:"0.18",def_p:"0.18"},3:{hp_p:"0.3",atk_p:"0.3",def_p:"0.38",bonus_glacio:"0.3",bonus_fusion:"0.3",bonus_electro:"0.3",bonus_aero:"0.3",bonus_spectro:"0.3",bonus_havoc:"0.3",energy_regen:"0.32"},4:{hp_p:"0.33",atk_p:"0.33",def_p:"0.418",crit_rate:"0.22",crit_dmg:"0.44",bonus_healing:"0.264"}},qs=Ys,Qs=Zs;function V(o){if(!o)return"";const s=o.toUpperCase(),t=xs[s];return t||""}function ms(o){return qs[o]}function x(o){return Qs[o]}class J{constructor(){a(this,"no","");a(this,"name","");a(this,"sonata","");a(this,"cost","");a(this,"main_affix",new b);a(this,"sub_affix",new b);a(this,"_fixed_main_affix_key","");a(this,"_main_affix_item",{title:"",value:void 0});a(this,"_main_affix_items",[]);a(this,"_item",{title:"",value:void 0});a(this,"_sonatas",this.getSonataNames())}duplicate(){const s=new J;return s.no=this.no,s.name=this.name,s.sonata=this.sonata,s.main_affix=this.main_affix.duplicate(),s.sub_affix=this.sub_affix.duplicate(),s._fixed_main_affix_key=this._fixed_main_affix_key,s._main_affix_item=JSON.parse(JSON.stringify(this._main_affix_item)),s._main_affix_items=JSON.parse(JSON.stringify(this._main_affix_items)),s._item=JSON.parse(JSON.stringify(this._item)),s._sonatas=JSON.parse(JSON.stringify(this._sonatas)),s}reset(){this.cost="",this._item={title:"",value:void 0},this.resetMainAffix(),this.resetSubAffix()}resetMainAffix(){this.main_affix=new b,this._fixed_main_affix_key="",this._main_affix_item={title:"",value:void 0}}resetSubAffix(){this.sub_affix=new b}getCosts(){return M().getCosts()}getEchoItems(){return M().getEchoItemsForCalculation()}getSonataNames(){return M().getSonataNames()}getSubAffixKeys(){return M().getSubAffixKeys()}updateByCost(s){if(!s)return;switch(this.cost=s,this.updateMainAffixKeysByCost(),this.resetMainAffix(),this.cost){case"4":case"3":this._fixed_main_affix_key=Z.ATK;break;case"1":this._fixed_main_affix_key=Z.HP;break}const t=ms(this.cost);this.main_affix[this._fixed_main_affix_key]=t[this._fixed_main_affix_key],this._main_affix_item={title:"",value:void 0}}updateByEchoItem(s){!s||!s.title||!s.value||(this.name=s.value.name,s.value.sonatas&&s.value.sonatas.length>0?this._sonatas=s.value.sonatas:this._sonatas=this.getSonataNames(),this.sonata="",this._sonatas.length===1&&(this.sonata=this._sonatas[0]),this._item=s,this.updateByCost(s.value.cost))}updateMainAffix(s){const t=this.cost;if(!s||!t)return;this._main_affix_item={title:V(s),value:s};const e=x(t);this.main_affix[s]=e[s]}updateMainAffixKeysByCost(){const s=this.cost;if(!s)return;const t=x(s);this._main_affix_items=Object.keys(t).map((e,i,_)=>({title:V(e),value:e}))}}class z{constructor(){a(this,"name1","");a(this,"sonatas",[]);a(this,"total_cost",0);a(this,"main_affix",new b);a(this,"sub_affix",new b)}duplicate(){const s=new z;return s.name1=this.name1,s.sonatas=JSON.parse(JSON.stringify(this.sonatas)),s.total_cost=this.total_cost,s.main_affix=this.main_affix.duplicate(),s.sub_affix=this.sub_affix.duplicate(),s}getRowBuffs(){const s=this.main_affix.getRowBuffs(`${d.ECHO}-${w.MAIN_AFFIX}`),t=this.sub_affix.getRowBuffs(`${d.ECHO}-${w.SUB_AFFIX}`);return[...s,...t]}}class D{constructor(){a(this,"policy","");a(this,"base_attr","");a(this,"main_skill_bonus","");a(this,"echoes",[]);a(this,"summary",new z);this.echoes=Array.from({length:5},(s,t)=>new J)}duplicate(){const s=new D;return s.policy=this.policy,s.base_attr=this.base_attr,this.echoes.forEach((t,e)=>{s.echoes[e]=t.duplicate()}),s.summary=this.summary.duplicate(),s}getRowBuffs(){return this.summary.getRowBuffs()}getPassiveSkillRowBuff(s,t,e,i,_){const r=new I;return r.category=d.ECHO,r.source=s,r.type=t,r.value=_,r.stack="1",r.element=e,r.skill_bonus_type=i,r.updateId(),r}getPassiveSkillRowBuffs(){const s=[],t=this.summary.name1;if(!t)return s;const e=`${t}-${w.MAIN_SLOT}`;switch(t){case R.HECATE:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.COORDINATED_ATTACK,"0.4"));break;case R.SENTRY_CONSTRUCT:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.GLACIO,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.SKILL,"0.12"));break;case R.LORELEI:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.HAVOC,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.BASIC,"0.12"));break;case R.NIGHTMARE_INFERNO_RIDER:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.FUSION,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.SKILL,"0.12"));case R.NIGHTMARE_THUNDERING_MEPHIS:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.ELECTRO,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.LIBERATION,"0.12"));case R.NIGHTMARE_TEMPEST_MEPHIS:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.ELECTRO,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.SKILL,"0.12"));case R.DRAGON_OF_DIRGE:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.FUSION,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.BASIC,"0.12"));case R.NIGHTMARE_CROWNLESS:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.HAVOC,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.BASIC,"0.12"));case R.NIGHTMARE_MOURNING_AIX:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.SPECTRO,"","0.12"));case R.NIGHTMARE_IMPERMANENCE_HERON:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.HAVOC,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.HEAVY,"0.12"));case R.NIGHTMARE_FEILIAN_BERINGAL:s.push(this.getPassiveSkillRowBuff(e,n.BONUS,u.AERO,"","0.12")),s.push(this.getPassiveSkillRowBuff(e,n.BONUS,"",p.HEAVY,"0.12"));default:return s}return s}getSonataRowBuff(s,t,e,i,_){const r=new I;return r.category=d.SONATA,r.source=`${s}-2/2`,r.type=t,r.value=_,r.stack="1",r.element=e,r.skill_bonus_type=i,r.updateId(),r}getSonataRowBuffs(){const s=[],t={[f.FREEZING_FROST]:0,[f.MOLTEN_RIFT]:0,[f.VOID_THUNDER]:0,[f.SIERRA_GALE]:0,[f.CELESTIAL_LIGHT]:0,[f.SUN_SINKING_ECLIPSE]:0,[f.REJUVENATING_GLOW]:0,[f.MOONLIT_CLOUDS]:0,[f.LINGERING_TUNES]:0,[f.FROSTY_RESOLVE]:0,[f.ETERNAL_RADIANCE]:0,[f.MIDNIGHT_VEIL]:0,[f.EMPYREAN_ANTHEM]:0,[f.TIDEBREAKING_COURAGE]:0};if(this.echoes.forEach(e=>{const i=e.sonata;i&&(t[i]+=1)}),t[f.FREEZING_FROST]>=2){const e=this.getSonataRowBuff(f.FREEZING_FROST,n.BONUS,u.GLACIO,"","0.1");s.push(e)}if(t[f.MOLTEN_RIFT]>=2){const e=this.getSonataRowBuff(f.MOLTEN_RIFT,n.BONUS,u.FUSION,"","0.1");s.push(e)}if(t[f.VOID_THUNDER]>=2){const e=this.getSonataRowBuff(f.VOID_THUNDER,n.BONUS,u.ELECTRO,"","0.1");s.push(e)}if(t[f.SIERRA_GALE]>=2){const e=this.getSonataRowBuff(f.SIERRA_GALE,n.BONUS,u.AERO,"","0.1");s.push(e)}if(t[f.CELESTIAL_LIGHT]>=2){const e=this.getSonataRowBuff(f.CELESTIAL_LIGHT,n.BONUS,u.SPECTRO,"","0.1");s.push(e)}if(t[f.SUN_SINKING_ECLIPSE]>=2){const e=this.getSonataRowBuff(f.SUN_SINKING_ECLIPSE,n.BONUS,u.HAVOC,"","0.1");s.push(e)}if(t[f.LINGERING_TUNES]>=2){const e=this.getSonataRowBuff(f.LINGERING_TUNES,n.ATK_P,"","","0.1");s.push(e)}if(t[f.FROSTY_RESOLVE]>=2){const e=this.getSonataRowBuff(f.FROSTY_RESOLVE,n.BONUS,"",p.SKILL,"0.12");s.push(e)}if(t[f.ETERNAL_RADIANCE]>=2){const e=this.getSonataRowBuff(f.ETERNAL_RADIANCE,n.BONUS,u.SPECTRO,"","0.1");s.push(e)}if(t[f.MIDNIGHT_VEIL]>=2){const e=this.getSonataRowBuff(f.MIDNIGHT_VEIL,n.BONUS,u.HAVOC,"","0.1");s.push(e)}return s}getEchoPolicyItems(){return[{title:U.global.t(`general.${A.AFFIXES_15_1}`),value:A.AFFIXES_15_1},{title:U.global.t(`general.${A.AFFIXES_20_SMALL}`),value:A.AFFIXES_20_SMALL},{title:U.global.t(`general.${A.AFFIXES_20_SKILL_BONUS}`),value:A.AFFIXES_20_SKILL_BONUS}]}resetPolicy(){this.policy=""}resetSummary(){this.summary.name1="",this.summary.sonatas=[],this.summary.total_cost=0,this.summary.main_affix=new b,this.summary.sub_affix=new b}getEcho(s){return this.echoes[s]}updateEchoByCost(s,t){this.resetPolicy(),this.getEcho(s).updateByCost(t)}updateEchoByEchoItem(s,t){this.resetPolicy(),this.getEcho(s).updateByEchoItem(t)}updateEchoMainAffix(s,t){this.resetPolicy(),this.getEcho(s).updateMainAffix(t)}updateSummaryByEchoes(){this.resetSummary();const s=this.echoes[0].name;s&&(this.summary.name1=s),this.echoes.forEach(t=>{this.summary.total_cost+=parseFloat(t.cost);const e=t.sonata;e&&this.summary.sonatas.push(e),this.summary.main_affix.addStatBuff(t.main_affix),this.summary.sub_affix.addStatBuff(t.sub_affix)})}}var ss,ts,es,as,is,ns,os,rs,_s,fs,us,cs,ls,hs;hs=c.SKILL_DMG_ADDITION,ls=c.MAGNIFIER,cs=c.AMPLIFIER,us=c.BONUS,fs=c.HP_P,_s=c.HP,rs=c.ATK_P,os=c.ATK,ns=c.DEF_P,is=c.DEF,as=c.CRIT_RATE,es=c.CRIT_DMG,ts=c.IGNORE_DEF,ss=c.REDUCE_RES;class st{constructor(){a(this,hs,"");a(this,ls,"");a(this,cs,"");a(this,us,"");a(this,fs,"");a(this,_s,"");a(this,rs,"");a(this,os,"");a(this,ns,"");a(this,is,"");a(this,as,"");a(this,es,"");a(this,ts,"");a(this,ss,"")}reset(){this[c.SKILL_DMG_ADDITION]="",this[c.MAGNIFIER]="",this[c.AMPLIFIER]="",this[c.BONUS]="",this[c.HP_P]="",this[c.HP]="",this[c.ATK_P]="",this[c.ATK]="",this[c.DEF_P]="",this[c.DEF]="",this[c.CRIT_RATE]="",this[c.CRIT_DMG]="",this[c.IGNORE_DEF]="",this[c.REDUCE_RES]=""}getKeys(){const s=[];return Object.values(c).forEach(t=>{const e=this[t];h(e)>0&&s.push(t)}),s}getRowBuffs(){const s=[];return this.getKeys().forEach(e=>{const i=n[e.toUpperCase()],_=h(this[e]).toString(),r=new I;r.category=d.MANUAL,r.source=d.MANUAL,r.type=i,r.value=_,r.stack="1",r.updateId(),s.push(r)}),s}}class ps{constructor(){a(this,"buffs",[]);a(this,"manual",new st)}getRowBuffs(){return[...this.buffs,...this.manual.getRowBuffs()]}}const tt=[{name:"90等抗性10白板",level:"90",def:"1512",res_physics:"10.00%",res_glacio:"10.00%",res_fusion:"10.00%",res_electro:"10.00%",res_aero:"10.00%",res_spectro:"10.00%",res_havoc:"10.00%"},{name:"90等抗性20白板",level:"90",def:"1512",res_physics:"20.00%",res_glacio:"20.00%",res_fusion:"20.00%",res_electro:"20.00%",res_aero:"20.00%",res_spectro:"20.00%",res_havoc:"20.00%"},{name:"90等抗性30白板",level:"90",def:"1512",res_physics:"30.00%",res_glacio:"30.00%",res_fusion:"30.00%",res_electro:"30.00%",res_aero:"30.00%",res_spectro:"30.00%",res_havoc:"30.00%"},{name:"90等抗性40白板",level:"90",def:"1512",res_physics:"40.00%",res_glacio:"40.00%",res_fusion:"40.00%",res_electro:"40.00%",res_aero:"40.00%",res_spectro:"40.00%",res_havoc:"40.00%"},{name:"90等抗性50白板",level:"90",def:"1512",res_physics:"50.00%",res_glacio:"50.00%",res_fusion:"50.00%",res_electro:"50.00%",res_aero:"50.00%",res_spectro:"50.00%",res_havoc:"50.00%"},{name:"90等抗性60白板",level:"90",def:"1512",res_physics:"60.00%",res_glacio:"60.00%",res_fusion:"60.00%",res_electro:"60.00%",res_aero:"60.00%",res_spectro:"60.00%",res_havoc:"60.00%"},{name:"90等抗性70白板",level:"90",def:"1512",res_physics:"70.00%",res_glacio:"70.00%",res_fusion:"70.00%",res_electro:"70.00%",res_aero:"70.00%",res_spectro:"70.00%",res_havoc:"70.00%"},{name:"90等抗性80白板",level:"90",def:"1512",res_physics:"80.00%",res_glacio:"80.00%",res_fusion:"80.00%",res_electro:"80.00%",res_aero:"80.00%",res_spectro:"80.00%",res_havoc:"80.00%"},{name:"100等抗性10白板",level:"100",def:"1592",res_physics:"10.00%",res_glacio:"10.00%",res_fusion:"10.00%",res_electro:"10.00%",res_aero:"10.00%",res_spectro:"10.00%",res_havoc:"10.00%"},{name:"100等抗性20白板",level:"100",def:"1592",res_physics:"20.00%",res_glacio:"20.00%",res_fusion:"20.00%",res_electro:"20.00%",res_aero:"20.00%",res_spectro:"20.00%",res_havoc:"20.00%"},{name:"100等抗性30白板",level:"100",def:"1592",res_physics:"30.00%",res_glacio:"30.00%",res_fusion:"30.00%",res_electro:"30.00%",res_aero:"30.00%",res_spectro:"30.00%",res_havoc:"30.00%"},{name:"100等抗性40白板",level:"100",def:"1592",res_physics:"40.00%",res_glacio:"40.00%",res_fusion:"40.00%",res_electro:"40.00%",res_aero:"40.00%",res_spectro:"40.00%",res_havoc:"40.00%"},{name:"100等抗性50白板",level:"100",def:"1592",res_physics:"50.00%",res_glacio:"50.00%",res_fusion:"50.00%",res_electro:"50.00%",res_aero:"50.00%",res_spectro:"50.00%",res_havoc:"50.00%"},{name:"100等抗性60白板",level:"100",def:"1592",res_physics:"60.00%",res_glacio:"60.00%",res_fusion:"60.00%",res_electro:"60.00%",res_aero:"60.00%",res_spectro:"60.00%",res_havoc:"60.00%"},{name:"100等抗性70白板",level:"100",def:"1592",res_physics:"70.00%",res_glacio:"70.00%",res_fusion:"70.00%",res_electro:"70.00%",res_aero:"70.00%",res_spectro:"70.00%",res_havoc:"70.00%"},{name:"100等抗性80白板",level:"100",def:"1592",res_physics:"80.00%",res_glacio:"80.00%",res_fusion:"80.00%",res_electro:"80.00%",res_aero:"80.00%",res_spectro:"80.00%",res_havoc:"80.00%"}],Q=tt,et=W("monster",{state:()=>({}),actions:{getMonsterItems(){return Q.map((s,t,e)=>({title:s.name,value:s}))},getMonsterItemByName(o){for(const s of Q)if(s.name===o)return{title:s.name,value:s}}}});class ds{constructor(){a(this,"name","");a(this,"level","");a(this,"def","");a(this,"res_physics","");a(this,"res_glacio","");a(this,"res_fusion","");a(this,"res_electro","");a(this,"res_aero","");a(this,"res_spectro","");a(this,"res_havoc","");a(this,"_item",{title:"",value:void 0})}updateByMonsterItem(s){if(!s)return;const t=s;this.name=t.name,this.level=t.level,this.def=t.def,this.res_physics=t.res_physics,this.res_glacio=t.res_glacio,this.res_fusion=t.res_fusion,this.res_electro=t.res_electro,this.res_aero=t.res_aero,this.res_spectro=t.res_spectro,this.res_havoc=t.res_havoc}updateByName(s){const e=et().getMonsterItemByName(s);e&&this.updateByMonsterItem(e.value)}}class at{constructor(){a(this,"resonator",new C);a(this,"weapon",new F);a(this,"echoes",new D);a(this,"buffs",new ps);a(this,"monster",new ds)}}class it{constructor(){a(this,"base_attr",[]);a(this,"base_attr_p",[]);a(this,"base_attr_a",[]);a(this,"skill_dmg_addition",[]);a(this,"magnifier",[]);a(this,"amplifier",[]);a(this,"bonus",[]);a(this,"crit_rate",[]);a(this,"crit_dmg",[]);a(this,"ignore_def",[]);a(this,"reduce_res",[])}reset(){this.base_attr=[],this.base_attr_p=[],this.base_attr_a=[],this.skill_dmg_addition=[],this.magnifier=[],this.amplifier=[],this.bonus=[],this.crit_rate=[],this.crit_dmg=[],this.ignore_def=[],this.reduce_res=[]}}class nt{constructor(){a(this,"labels",[]);a(this,"resonator_name","");a(this,"skill_id","");a(this,"resonator_level","");a(this,"resonator_skill_level","");a(this,"resonator_skill_element","");a(this,"resonator_skill_base_attr","");a(this,"resonator_skill_type","");a(this,"resonator_skill_type_bonus","");a(this,"resonator_skill_bonus_types",[]);a(this,"resonator_skill_dmg","");a(this,"resonator_skill_dmg_addition","");a(this,"echo_element","");a(this,"echo_skill_base_attr","");a(this,"echo_skill_dmg","");a(this,"damage_no_crit","");a(this,"damage_crit","");a(this,"damage","");a(this,"result_element","");a(this,"result_bonus_type","");a(this,"result_bonus_types","");a(this,"result_skill_base_attribute","");a(this,"result_skill_dmg","");a(this,"result_skill_hit","1");a(this,"result_hp","");a(this,"result_hp_addition","");a(this,"result_hp_p","");a(this,"result_atk","");a(this,"result_atk_addition","");a(this,"result_atk_p","");a(this,"result_def","");a(this,"result_def_addition","");a(this,"result_def_p","");a(this,"result_crit_rate","");a(this,"result_crit_dmg","");a(this,"result_magnifier","");a(this,"result_amplifier","");a(this,"result_bonus","");a(this,"result_ignore_def","");a(this,"result_reduce_res","");a(this,"monster_level","");a(this,"monster_def","");a(this,"monster_res","");a(this,"hits","");a(this,"real_dmg_no_crit","");a(this,"real_dmg_crit","");a(this,"action","");a(this,"time_start","");a(this,"time_end","");a(this,"buffs",[])}}class lt{constructor(s=new C,t=new F,e=new D,i=new ps,_=new ds){a(this,"id","");a(this,"data",new at);a(this,"regions",new it);a(this,"result",new nt);this.data.resonator=s,this.data.weapon=t,this.data.echoes=e,this.data.buffs=i,this.data.monster=_}reset(){this.regions.reset()}getBaseRowBuffs(){const s=[],t=new I;t.category=d.BASE,t.source=d.BASE,t.type=n.CRIT_RATE,t.value="0.05",t.stack="1",t.updateId(),s.push(t);const e=new I;return e.category=d.BASE,e.source=d.BASE,e.type=n.CRIT_DMG,e.value="1.5",e.stack="1",e.updateId(),s.push(e),s}getRowBuffs(){this.data.echoes.updateSummaryByEchoes();let s=this.data.resonator.getBaseAttrs(),t=[];this.data.resonator.skill.base_attr===l.ATK&&(t=this.data.weapon.getBaseAttrs());const e=this.getBaseRowBuffs(),i=this.getMonsterResRowBuffs(),_=this.data.resonator.getRowBuffs(),r=this.data.resonator.getSkillRowBuffs(),k=this.data.weapon.getRowBuffs(),g=this.data.echoes.getRowBuffs(),S=this.data.echoes.getSonataRowBuffs(),E=this.data.echoes.getPassiveSkillRowBuffs(),N=this.data.buffs.getRowBuffs();return[...e,...i,...s,...t,..._,...r,...k,...g,...S,...E,...N]}getMonsterRes(){const s=this.data.resonator.skill.elment_zh_tw;let t;switch(s){case u.GLACIO:t=this.data.monster.res_glacio;break;case u.FUSION:t=this.data.monster.res_fusion;break;case u.ELECTRO:t=this.data.monster.res_electro;break;case u.AERO:t=this.data.monster.res_aero;break;case u.SPECTRO:t=this.data.monster.res_spectro;break;case u.HAVOC:t=this.data.monster.res_havoc;break;default:t="0.2";break}return h(t)}getFinalMonsterRes(){const s=this.regions.reduce_res;let t;return s.forEach((e,i)=>{const _=h(e.value)*h(e.stack);i===0?t=_:(t||(t=h(t)),t-=_)}),h(t)}getMonsterResRowBuffs(){const s=[],t=new I;return t.category=d.MONSTER,t.source=this.data.monster.name,t.type=n.REDUCE_RES,t.value=this.getMonsterRes().toString(),t.stack="1",t.element=this.data.resonator.skill.elment_zh_tw,t.updateId(),s.push(t),s}updateId(){this.id=Os(JSON.stringify(this.data))}updateRegions(s){const t=this.data.resonator.skill.base_attr;s.forEach(e=>{switch(e.type){case $.ATTR:this.regions.base_attr.push(e);break;case n.SKILL_DMG_ADDITION:this.regions.skill_dmg_addition.push(e);break;case n.MAGNIFIER:this.regions.magnifier.push(e);break;case n.AMPLIFIER:this.regions.amplifier.push(e);break;case n.BONUS:if(!e.element&&!e.skill_bonus_type){this.regions.bonus.push(e);break}if(e.element&&e.skill_bonus_type)throw new Error("`element` and `skill_bonus_type` should not have values at the same time.");if(this.data.resonator.skill.bonus_types.includes(e.element)||this.data.resonator.skill.bonus_types.includes(e.skill_bonus_type)){this.regions.bonus.push(e);break}break;case n.HP_P:t===l.HP&&this.regions.base_attr_p.push(e);break;case n.HP:t===l.HP&&this.regions.base_attr_a.push(e);break;case n.ATK_P:t===l.ATK&&this.regions.base_attr_p.push(e);break;case n.ATK:t===l.ATK&&this.regions.base_attr_a.push(e);break;case n.DEF_P:t===l.DEF&&this.regions.base_attr_p.push(e);break;case n.DEF:t===l.DEF&&this.regions.base_attr_a.push(e);break;case n.CRIT_RATE:this.regions.crit_rate.push(e);break;case n.CRIT_DMG:this.regions.crit_dmg.push(e);break;case n.IGNORE_DEF:this.regions.ignore_def.push(e);break;case n.REDUCE_RES:this.regions.reduce_res.push(e);break}})}sumRegion(s){let t=0;return s.forEach(e=>{const i=h(e.value)*h(e.stack);t+=i}),t}calculate(){this.updateId(),this.reset();const s=this.getRowBuffs();this.updateRegions(s);const t=this.sumRegion(this.regions.base_attr),e=this.sumRegion(this.regions.base_attr_p),i=this.sumRegion(this.regions.base_attr_a),_=t*(1+e)+i,r=this.sumRegion(this.regions.skill_dmg_addition),g=1+this.sumRegion(this.regions.magnifier),E=1+this.sumRegion(this.regions.amplifier),bs=1+this.sumRegion(this.regions.bonus),gs=this.sumRegion(this.regions.crit_dmg);let O=this.sumRegion(this.regions.crit_rate);O>=1&&(O=1);const X=h(this.data.resonator.level),Es=h(this.data.monster.level),Rs=this.sumRegion(this.regions.ignore_def),ks=(800+8*X)/(800+8*X+(792+8*Es)*(1-Rs)),v=this.getFinalMonsterRes();let T;v<0?T=1-v/2:v>=.8?T=1/(1+5*v):T=1-v;const G=_*r*g*E*bs*ks*T,Y=G*gs,Ss=Y*O+G*(1-O);this.result.resonator_name=this.data.resonator.name,this.result.skill_id=this.data.resonator.skill.id,this.result.resonator_level=this.data.resonator.level,this.result.resonator_skill_level=this.data.resonator.skill.level,this.result.resonator_skill_element=this.data.resonator.skill.elment_zh_tw,this.result.resonator_skill_base_attr=this.data.resonator.skill.base_attr,this.result.resonator_skill_type=this.data.resonator.skill.type,this.result.resonator_skill_bonus_types=this.data.resonator.skill.bonus_types,this.result.damage=P(Ss),this.result.damage_crit=P(Y),this.result.damage_no_crit=P(G)}}class ot{constructor(s,t,e){a(this,"resonator");a(this,"weapon");a(this,"echoes");if(this.resonator=s,this.weapon=t,this.echoes=e,e.echoes.length!==5)throw new Error("`echoStores` length must be exactly 5")}getBaseAbbr(){const s=this.echoes.base_attr;let t;switch(s){case l.HP:t=m.HP;break;case l.DEF:t=m.DEF;break;case l.ATK:default:t=m.ATK;break}return t}getCritAttr(){const s=parseFloat(this.weapon.stat_bonus.crit_rate),t=parseFloat(this.weapon.stat_bonus.crit_dmg);return!s&&t?m.CRIT_RATE:s&&!t?m.CRIT_DMG:m.CRIT_DMG}updateSubAffixesWithAffixes151(s){switch(this.echoes.base_attr){case l.HP:s.sub_affix.hp="270",s.sub_affix.hp_p="0.054";break;case l.DEF:s.sub_affix.def="30",s.sub_affix.def_p="0.068325";break;case l.ATK:default:s.sub_affix.atk="24",s.sub_affix.atk_p="0.054";break}s.sub_affix.crit_rate="0.084",s.sub_affix.crit_dmg="0.1008",s.sub_affix.bonus_resonance_skill="0.016",s.sub_affix.bonus_basic_attack="0.016",s.sub_affix.bonus_heavy_attack="0.016",s.sub_affix.bonus_resonance_liberation="0.016"}updateSubAffixesWithAffixes20Small(s){switch(this.echoes.base_attr){case l.HP:s.sub_affix.hp="450",s.sub_affix.hp_p="0.09";break;case l.DEF:s.sub_affix.def="50",s.sub_affix.def_p="0.113875";break;case l.ATK:default:s.sub_affix.atk="40",s.sub_affix.atk_p="0.09";break}s.sub_affix.crit_rate="0.084",s.sub_affix.crit_dmg="0.168"}updateSubAffixesWithAffixes20SkillBonus(s){switch(this.echoes.base_attr){case l.HP:s.sub_affix.hp_p="0.09";break;case l.DEF:s.sub_affix.def_p="0.113875";break;case l.ATK:default:s.sub_affix.atk_p="0.09";break}switch(s.sub_affix.crit_rate="0.084",s.sub_affix.crit_dmg="0.168",this.echoes.main_skill_bonus){case p.SKILL:s.sub_affix.bonus_resonance_skill="0.09";break;case p.BASIC:s.sub_affix.bonus_basic_attack="0.09";break;case p.HEAVY:s.sub_affix.bonus_heavy_attack="0.09";break;case p.LIBERATION:s.sub_affix.bonus_resonance_liberation="0.09";break}}updateBase(){this.echoes.echoes.forEach((s,t)=>{switch(s.resetMainAffix(),s.resetSubAffix(),this.echoes.policy){case A.AFFIXES_15_1:this.updateSubAffixesWithAffixes151(s);break;case A.AFFIXES_20_SMALL:this.updateSubAffixesWithAffixes20Small(s);break;case A.AFFIXES_20_SKILL_BONUS:this.updateSubAffixesWithAffixes20SkillBonus(s);break}})}updateFixedMainAffix(s,t){const e=ms(t);for(const[i,_]of Object.entries(e))s.main_affix[i]=_,s._fixed_main_affix_key=i}updateMainAffixItem(s,t){s._main_affix_item={title:V(t),value:t}}updateCost4Echo(s,t){const e="4";s.cost=e,s.updateMainAffixKeysByCost(),this.updateFixedMainAffix(s,e);const i=x(e);switch(t){case m.HP:s.main_affix.hp_p=i.hp_p,this.updateMainAffixItem(s,"hp_p");break;case m.ATK:s.main_affix.atk_p=i.atk_p,this.updateMainAffixItem(s,"atk_p");break;case m.DEF:s.main_affix.def_p=i.def_p,this.updateMainAffixItem(s,"def_p");break;case m.BONUS_HEALING:s.main_affix.bonus_healing=i.bonus_healing,this.updateMainAffixItem(s,"bonus_healing");break;case m.CRIT_RATE:s.main_affix.crit_rate=i.crit_rate,this.updateMainAffixItem(s,"crit_rate");break;case m.CRIT_DMG:default:s.main_affix.crit_dmg=i.crit_dmg,this.updateMainAffixItem(s,"crit_dmg");break}}updateCost3Echo(s,t){const e="3";s.cost=e,s.updateMainAffixKeysByCost(),this.updateFixedMainAffix(s,e);const i=x(e);switch(t){case m.HP:s.main_affix.hp_p=i.hp_p,this.updateMainAffixItem(s,"hp_p");break;case m.ATK:s.main_affix.atk_p=i.atk_p,this.updateMainAffixItem(s,"atk_p");break;case m.DEF:s.main_affix.def_p=i.def_p,this.updateMainAffixItem(s,"def_p");break;case m.ENERGY_REGEN:s.main_affix.energy_regen=i.energy_regen,this.updateMainAffixItem(s,"energy_regen");break;case u.GLACIO:s.main_affix.bonus_glacio=i.bonus_glacio,this.updateMainAffixItem(s,"bonus_glacio");break;case u.FUSION:s.main_affix.bonus_fusion=i.bonus_fusion,this.updateMainAffixItem(s,"bonus_fusion");break;case u.ELECTRO:s.main_affix.bonus_electro=i.bonus_electro,this.updateMainAffixItem(s,"bonus_electro");break;case u.AERO:s.main_affix.bonus_aero=i.bonus_aero,this.updateMainAffixItem(s,"bonus_aero");break;case u.SPECTRO:s.main_affix.bonus_spectro=i.bonus_spectro,this.updateMainAffixItem(s,"bonus_spectro");break;case u.HAVOC:s.main_affix.bonus_havoc=i.bonus_havoc,this.updateMainAffixItem(s,"bonus_havoc");break}}updateCost1Echo(s,t){const e="1";s.cost=e,s.updateMainAffixKeysByCost(),this.updateFixedMainAffix(s,e);const i=x(e);switch(t){case m.HP:s.main_affix.hp_p=i.hp_p,this.updateMainAffixItem(s,"hp_p");break;case m.ATK:s.main_affix.atk_p=i.atk_p,this.updateMainAffixItem(s,"atk_p");break;case m.DEF:s.main_affix.def_p=i.def_p,this.updateMainAffixItem(s,"def_p");break}}updateEcho(s,t,e){switch(t=t.toString(),t){case"4":e||(e=this.getCritAttr()),this.updateCost4Echo(this.echoes.echoes[s],e);break;case"3":e||(e=this.resonator.element_zh_tw),this.updateCost3Echo(this.echoes.echoes[s],e);break;case"1":e||(e=this.getBaseAbbr()),this.updateCost1Echo(this.echoes.echoes[s],e);break;default:return}}update(s,t,e,i,_,r,k,g,S,E){!this.echoes.policy||this.echoes.echoes.length===0||(this.updateBase(),this.updateEcho(0,s,r),this.updateEcho(1,t,k),this.updateEcho(2,e,g),this.updateEcho(3,i,S),this.updateEcho(4,_,E))}update43311(s="",t="",e="",i="",_=""){this.update("4","3","3","1","1",s,t,e,i,_)}update43311With2Elem(){this.echoes.base_attr,this.resonator.element_zh_tw}update43311With1Elem1Attr(){this.resonator.element_zh_tw}update43311With2Attr(){}update43311With2EnergyRegen(){}update43311With1EnergyRegen1Elem(){this.resonator.element_zh_tw}update43311With1EnergyRegen1Attr(){}}function ht(o,s,t){new ot(o,s,t).update43311()}export{ps as R,ds as a,D as b,F as c,C as d,ht as e,Xs as f,V as g,ot as h,lt as i,M as j,q as s,et as u};
