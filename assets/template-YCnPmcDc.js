var R=Object.defineProperty;var y=(i,o,t)=>o in i?R(i,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[o]=t;var s=(i,o,t)=>y(i,typeof o!="symbol"?o+"":o,t);import{A as k}from"./affix-NmzP8Gk5.js";import{i as E,j as B,h as x,a as w,R as j,d as O,c as I,b as N}from"./echoes-CvqTKTUu.js";import{R as T}from"./resonator-Db-i-zYr.js";import{g as v}from"./rotation-DidOErHT.js";class l{constructor(o={}){s(this,"resonator_name","");s(this,"resonator_chain","");s(this,"resonator_weapon_name","");s(this,"resonator_weapon_rank","");s(this,"resonator_inherent_skill_1",!0);s(this,"resonator_inherent_skill_2",!0);s(this,"resonator_base_attr","");s(this,"resonator_skill_bonus","");s(this,"resonator_energy_regen","");s(this,"resonator_echo_1","");s(this,"resonator_echo_sonata_1","");s(this,"resonator_echo_sonata_2","");s(this,"resonator_echo_sonata_3","");s(this,"resonator_echo_sonata_4","");s(this,"resonator_echo_sonata_5","");s(this,"resonator_echo_cost_1","");s(this,"resonator_echo_cost_2","");s(this,"resonator_echo_cost_3","");s(this,"resonator_echo_cost_4","");s(this,"resonator_echo_cost_5","");s(this,"resonator_echo_affix_1","");s(this,"resonator_echo_affix_2","");s(this,"resonator_echo_affix_3","");s(this,"resonator_echo_affix_4","");s(this,"resonator_echo_affix_5","");s(this,"sub_tab","resonator");Object.keys(o).length!==0&&Object.assign(this,o)}}class f{constructor(o={}){s(this,"name","");s(this,"type","");s(this,"value","");s(this,"stack","");s(this,"duration","");s(this,"id",0);s(this,"selected",!1);Object.keys(o).length!==0&&Object.assign(this,o)}isEmpty(){return!(this.name||this.type||this.value||this.stack||this.duration)}}class C{constructor(o={}){s(this,"labels",[]);s(this,"resonator_name","");s(this,"real_dmg_no_crit","");s(this,"real_dmg_crit","");s(this,"action","");s(this,"skill_id","");s(this,"skill_bonus_type","");s(this,"hit","1");s(this,"buffs",[new f]);s(this,"resonating_spin_concerto_regen","");s(this,"accumulated_resonating_spin_concerto_regen","");s(this,"time_start","");s(this,"time_end","");s(this,"cumulative_time","");s(this,"comment","");s(this,"id",0);s(this,"selected",!1);s(this,"skill_ids",[]);s(this,"row_buffs",[]);s(this,"calculation",new E);if(o&&Object.keys(o).length===0)return;const{buffs:t,...n}=o;Object.assign(this,n),t.length>0&&(this.buffs=[],t.forEach((r,a)=>{const e=new f(r);e.id=a,this.buffs.push(e)}))}areBuffs(){for(const o of this.buffs)if(!o.isEmpty())return!0;return!1}calculate(o,t,n,r,a){this.calculation.data.resonator=o,this.calculation.data.weapon=t,this.calculation.data.echoes=n,this.calculation.data.monster=a,this.calculation.data.buffs=r,this.buffs.forEach(e=>{const c=new T;c.id=e.name,c.type=e.type,c.value=e.value,c.stack=e.stack,c.duration=e.duration,this.calculation.data.buffs.buffs.push(c)}),this.calculation.calculate()}}class u{constructor(){s(this,"resonator",new O);s(this,"weapon",new I);s(this,"echoes",new N)}}class A{constructor(){s(this,"resonators",[new u,new u,new u]);s(this,"monster",new w)}}class X{constructor(o={}){s(this,"hashed_id","");s(this,"id","");s(this,"labels",[]);s(this,"test_resonator_id_1","");s(this,"test_resonator_id_2","");s(this,"test_resonator_id_3","");s(this,"duration_1","");s(this,"duration_2","");s(this,"monster_id","");s(this,"description","");s(this,"resonators",[]);s(this,"rows",[]);s(this,"calculation",new A);if(Object.keys(o).length===0){this.resonators=[new l,new l,new l];return}const{resonators:t,rows:n,...r}=o;Object.assign(this,r),t.length>0&&(this.resonators=[],t.forEach(a=>{this.resonators.push(new l(a))})),n.length>0&&(this.rows=[],n.forEach(a=>{this.rows.push(new C(a))}))}async initResonator(o){const t=B();this.calculation.resonators[o].resonator.name=this.resonators[o].resonator_name,await this.calculation.resonators[o].resonator.updateByName(),this.calculation.resonators[o].resonator.chain=this.resonators[o].resonator_chain,this.calculation.resonators[o].resonator.energy_regen=this.resonators[o].resonator_energy_regen,this.resonators[o].resonator_inherent_skill_1||(this.calculation.resonators[o].resonator.inherent_skill_1=!1),this.resonators[o].resonator_inherent_skill_2||(this.calculation.resonators[o].resonator.inherent_skill_2=!1),this.calculation.resonators[o].weapon.name=this.resonators[o].resonator_weapon_name,this.calculation.resonators[o].weapon.tune=this.resonators[o].resonator_weapon_rank,await this.calculation.resonators[o].weapon.updateRowWeaponByName(),this.calculation.resonators[o].echoes.base_attr=this.resonators[o].resonator_base_attr,this.calculation.resonators[o].echoes.main_skill_bonus=this.resonators[o].resonator_skill_bonus,this.calculation.resonators[o].echoes.echoes[0].name=this.resonators[o].resonator_echo_1;const n=t.getEchoItemForCalculationByName(this.resonators[o].resonator_echo_1);this.calculation.resonators[o].echoes.echoes[0].updateByEchoItem(n),this.calculation.resonators[o].echoes.echoes[0].sonata=this.resonators[o].resonator_echo_sonata_1,this.calculation.resonators[o].echoes.echoes[1].sonata=this.resonators[o].resonator_echo_sonata_2,this.calculation.resonators[o].echoes.echoes[2].sonata=this.resonators[o].resonator_echo_sonata_3,this.calculation.resonators[o].echoes.echoes[3].sonata=this.resonators[o].resonator_echo_sonata_4,this.calculation.resonators[o].echoes.echoes[4].sonata=this.resonators[o].resonator_echo_sonata_5,this.resonators[o].resonator_echo_cost_1&&(this.calculation.resonators[o].echoes.echoes[0].cost=this.resonators[o].resonator_echo_cost_1),this.calculation.resonators[o].echoes.echoes[1].cost=this.resonators[o].resonator_echo_cost_2,this.calculation.resonators[o].echoes.echoes[2].cost=this.resonators[o].resonator_echo_cost_3,this.calculation.resonators[o].echoes.echoes[3].cost=this.resonators[o].resonator_echo_cost_4,this.calculation.resonators[o].echoes.echoes[4].cost=this.resonators[o].resonator_echo_cost_5;const r=this.calculation.resonators[o].echoes.echoes[0].cost;let a=this.calculation.resonators[o].echoes.echoes[1].cost,e=this.calculation.resonators[o].echoes.echoes[2].cost,c=this.calculation.resonators[o].echoes.echoes[3].cost,h=this.calculation.resonators[o].echoes.echoes[4].cost;const _=this.resonators[o].resonator_echo_affix_1,m=this.resonators[o].resonator_echo_affix_2,p=this.resonators[o].resonator_echo_affix_3,d=this.resonators[o].resonator_echo_affix_4,g=this.resonators[o].resonator_echo_affix_5;if(!r||r==="4"){this.calculation.resonators[o].echoes.policy||(this.calculation.resonators[o].echoes.policy=k.AFFIXES_15_1);const b=new x(this.calculation.resonators[o].resonator,this.calculation.resonators[o].weapon,this.calculation.resonators[o].echoes);!a&&!e&&!c&&!h&&(a="3",e="3",c="1",h="1"),b.update(r,a,e,c,h,_,m,p,d,g)}}async init(){this.resonators.forEach(async(o,t)=>{await this.initResonator(t)})}getRowResonator(o){for(const t of this.calculation.resonators)if(o===t.resonator.name)return t.resonator}getRowWeapon(o){for(const t of this.calculation.resonators)if(o===t.resonator.name)return t.weapon}getRowEchoes(o){for(const t of this.calculation.resonators)if(o===t.resonator.name)return t.echoes}getRowMonster(){return this.calculation.monster}getResonatorEcho1(o){for(const t of this.resonators)if(o===t.resonator_name)return t.resonator_echo_1;return""}getResonatorNames(){const o=[];return this.resonators.forEach(t=>{o.push(t.resonator_name)}),o}getRotation(){const o=this.rows;return v(o)}getRotationIndices(){const o=[];return this.getRotation().forEach(n=>{n.actions.forEach(a=>{const e=a.index0Based;o.push(e)})}),o}async updateByResonatorName(o){await this.initResonator(o)}updateResonatorByCalculation(o){this.resonators[o].resonator_chain=this.calculation.resonators[o].resonator.chain,this.resonators[o].resonator_energy_regen=this.calculation.resonators[o].resonator.energy_regen,this.resonators[o].resonator_inherent_skill_1=this.calculation.resonators[o].resonator.inherent_skill_1,this.resonators[o].resonator_inherent_skill_2=this.calculation.resonators[o].resonator.inherent_skill_2,this.resonators[o].resonator_weapon_name=this.calculation.resonators[o].weapon.name,this.resonators[o].resonator_weapon_rank=this.calculation.resonators[o].weapon.tune}async calculateRow(o){if(this.rows.length<=o)return;const t=this.rows[o],n=t.resonator_name;if(!n)return;let r=this.getRowResonator(n);if(!r)return;r=r.duplicate(),r.updateSkillById(t.skill_id);let a=this.getRowWeapon(n);if(!a)return;a=a.duplicate();let e=this.getRowEchoes(n);if(!e)return;e=e.duplicate();const c=new j,h=new w,_=this.monster_id;h.updateByName(_),t.calculate(r,a,e,c,h)}async calculate(){for(let o=0;o<this.rows.length;o++)this.calculateRow(o)}}export{X as T,C as a};
